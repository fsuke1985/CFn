AWSTemplateFormatVersion: 2010-09-09
Description: create to RDS
##########################################
Metadata:
  AWS::CloudFormation::Interface:
    ParameterGroups: 
      - Label: 
          default: 'Infomation'
        Parameters: 
          - AvailabilityZone
          - SubnetID1
          - SubnetID2

Parameters:
  AvailabilityZone:
    Type: AWS::EC2::AvailabilityZone::Name
    Default: ap-northeast-1a

  SubnetID1:
    Type: AWS::EC2::Subnet::Id

  SubnetID2:
    Type: AWS::EC2::Subnet::Id

Resources:
  DMSVPCRole:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Version: '2012-10-17'
        Statement:
        - Effect: Allow
          Principal:
            Service:
            - dms.amazonaws.com
          Action: sts:AssumeRole
      ManagedPolicyArns:
      - arn:aws:iam::aws:policy/service-role/AmazonDMSVPCManagementRole
      Path: "/"
      RoleName: dms-vpc-role
      Tags:
        - Key: Description
          Value: !Sub CreatedBy${AWS::StackName}

  ReplicationSubnetGroup:
    Type: AWS::DMS::ReplicationSubnetGroup
    DependsOn: DMSVPCRole
    Properties:
      ReplicationSubnetGroupIdentifier: dms-subnet-group
      ReplicationSubnetGroupDescription: DMS subnet group
      SubnetIds: 
        - !Ref SubnetID1
        - !Ref SubnetID2

  ReplicationInstance:
    Type: AWS::DMS::ReplicationInstance
    DependsOn: ReplicationSubnetGroup
    Properties: 
      AllocatedStorage: 5
      AllowMajorVersionUpgrade: false
      AutoMinorVersionUpgrade: false
      AvailabilityZone: !Ref AvailabilityZone
      EngineVersion: 3.4.7
      # KmsKeyId: String
      MultiAZ: false
      # PreferredMaintenanceWindow: String
      PubliclyAccessible: false
      ReplicationInstanceClass: dms.t2.medium
      # ReplicationInstanceIdentifier: String
      ReplicationSubnetGroupIdentifier: !Ref ReplicationSubnetGroup
      # ResourceIdentifier: String
      # Tags: 
      #   - Tag
      # VpcSecurityGroupIds: 
      #   - String
